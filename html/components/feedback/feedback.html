<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="feedback.css" />
</head>

<body>
    <div id="header-placeholder"></div>
    <div class="d-flex justify-content-center align-items-center" style="margin-top: 5vh">
        <div class="card blur-card text-center">
            <div class="card-body feedback-container">
                <div class="feedback-content">
                    <img src="../../assets/Rating_face_1.png" alt="Dissatisfy" class="feedback-image"
                        onclick="sendFeedback('Dissatisfy')">
                </div>
                <div class="feedback-content">
                    <img src="../../assets/Rating_face_2.png" alt="Unhappy" class="feedback-image"
                        onclick="sendFeedback('Unhappy')">
                </div>
                <div class="feedback-content">
                    <img src="../../assets/Rating_face_3.png" alt="Neutral" class="feedback-image"
                        onclick="sendFeedback('Neutral')">
                </div>
                <div class="feedback-content">
                    <img src="../../assets/Rating_face_4.png" alt="Happy" class="feedback-image"
                        onclick="sendFeedback('Happy')">
                </div>
                <div class="feedback-content">
                    <img src="../../assets/Rating_face_5.png" alt="Exceptional" class="feedback-image"
                        onclick="sendFeedback('Exceptional')">
                </div>
            </div>
        </div>
    </div>
    <div class="feedback-button">
        <button class="btn btn-primary" id="homeButton">Home</button>
        <button class="btn btn-primary" onClick="sendEmail('test')">Send</button>
        <button class="btn btn-primary" id="exitButton">Exit</button>
    </div>

    <div id="testing">Test</div>

    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h5 class="modal-title">Enter Password</h5>
            <input type="password" id="passwordInput" class="form-control" placeholder="Enter your password">
            <button type="button" class="btn btn-primary submit-button" id="submitPassword">Submit</button>
        </div>
    </div>

    <div id="emailModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h5 class="modal-title">Enter email</h5>
            <input type="text" id="emailInput" class="form-control" placeholder="Enter your email">
            <button type="button" class="btn btn-primary submit-button" id="submitEmail">Submit</button>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="../../js/importHeader.js"></script>
    <!-- <script src="./feedback.js"></script>
    <script src="./feedbackNavigate.js"></script>
    <script src="./feedbackCollection.js"></script>
    <script src="./feedbackModal.js"></script> -->
    <script src="/libs/qimessaging/2/qimessaging.js"></script>
    <script src="/libs/qi/2/qi.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qi-js/2.10.3/qi.min.js"></script>
    <script src="https://www.promisejs.org/polyfills/promise-6.0.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2.4.0/dist/email.min.js"></script>
    <script>
        //emailjs.init("C23If__KQRFS7qbwo");
        document.getElementById("testing").innerHTML = "script"
        // Function to send an email with feedback data
        function sendEmail(recipientEmail) {
            //emailjs.init("C23If__KQRFS7qbwo");
            document.getElementById("testing").innerHTML = "Get to function"
            // // Retrieve feedback data from local storage
            // let feedbackData = localStorage.getItem("feedbackData");
            // feedbackData = feedbackData ? JSON.parse(feedbackData) : {};

            // // Convert feedback data to a readable format
            // let feedbackText = "";
            // for (const [key, value] of Object.entries(feedbackData)) {
            //     feedbackText += `${key}: ${value}\n`;
            // }

            var templateParams = {
                sendEmail: "hoangtukg5@gmail.com",
                date: getCurrentDate(),
                message: `Feedback data:`, //\n\n${feedbackText}
            };

            emailjs.send("pepperFeedbackEmail", "weeklyEmailTemp", templateParams).then(
                function (response) {
                    //console.log("SUCCESS!", response.status, response.text);
                    document.getElementById("testing").innerHTML = response.text
                },
                function (error) {
                    //console.log("FAILED...", error);
                    document.getElementById("testing").innerHTML = error
                }
            );
        }
    </script>
    <script>
                var session = new QiSession(function () {
            session = s;
        }, disconnected,location.host);

        function connected(s) {

        }
        function disconnected(error) {
            console.log("Session disconnected");
        }
    </script>
    <script>
        // Initialize EmailJS
        //emailjs.init("C23If__KQRFS7qbwo");

        // Function to send feedback and store it in local storage
        function sendFeedback(feedbackType) {
            // let feedbackData = localStorage.getItem("feedbackData");
            // feedbackData = feedbackData ? JSON.parse(feedbackData) : {};

            // if (feedbackData[feedbackType]) {
            //     feedbackData[feedbackType] += 1;
            // } else {
            //     feedbackData[feedbackType] = 1;
            // }

            // localStorage.setItem("feedbackData", JSON.stringify(feedbackData));
            // console.log("Feedback recorded:", feedbackData);
        }


    </script>
    <script>
                // Function to get the current date in dd-mm-yyyy format
                function getCurrentDate() {
            const date = new Date();
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}-${month}-${year}`;
        }
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("homeButton").addEventListener("click", function () {
                window.location.href = "../lessonSelection/lessonSelection.html";
            });
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".feedback-image").forEach((image) => {
                image.addEventListener("click", function () {
                    const feedbackType = this.alt;
                    sendFeedback(feedbackType);
                });
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            var correctPassword = "123456"; // Set your password here

            $("#sendButton").click(function () {
                $("#passwordModal").css("display", "block");
            });

            $(".close").click(function () {
                $("#passwordModal").css("display", "none");
                $("#emailModal").css("display", "none");
            });

            $(window).click(function (event) {
                if (event.target.id === "passwordModal") {
                    $("#passwordModal").css("display", "none");
                }
            });

            $("#submitPassword").click(function () {
                var enteredPassword = $("#passwordInput").val();
                if (enteredPassword === correctPassword) {
                    $("#passwordModal").css("display", "none");
                    $("#emailModal").css("display", "block");
                } else {
                    alert("Incorrect password. Please try again.");
                }
            });

            $("#submitEmail").click(function () {
                var enteredEmail = $("#emailInput").val();

                if (enteredEmail) {
                    $("#passwordModal").css("display", "none");
                    $("#emailModal").css("display", "none");
                    // Initialising EmailJS
                    emailjs.init("C23If__KQRFS7qbwo");
                    sendEmail(enteredEmail);
                } else {
                    alert("Enter an email!")
                }
            });
        });
    </script>
</body>

</html>